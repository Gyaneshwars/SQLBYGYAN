--PYTHON,SQL,AZURE DATA FACTORY AND POWER BI ETL DATA ANALYTICS DEVELOPER --> GNANESHWAR SRAVANE
USE Estimates
SELECT DISTINCT CP.feedfileid,CP.versionid,CP.CompanyId,CP.parentflag,CP.tradingitemId,CP.researchcontributorId,
CP.AccountingStandardID,C.ChecklogicID,C.Checkdescription,DM.dataitemname,EEDV.Value,
CASE WHEN FI.periodTypeId = 1 THEN 'FY ' + CAST(FI.fiscalYear AS VARCHAR)
WHEN FI.periodTypeId = 2 AND FI.fiscalquarter = 1 THEN 'Q1 ' + CAST(FI.fiscalYear AS VARCHAR)
WHEN FI.periodTypeId = 2 AND FI.fiscalquarter = 2 THEN 'Q2 ' + CAST(FI.fiscalYear AS VARCHAR)
WHEN FI.periodTypeId = 2 AND FI.fiscalquarter = 3 THEN 'Q3 ' + CAST(FI.fiscalYear AS VARCHAR)
WHEN FI.periodTypeId = 2 AND FI.fiscalquarter = 4 THEN 'Q4 ' + CAST(FI.fiscalYear AS VARCHAR)
WHEN FI.periodTypeId > 2 THEN 'OTHER ' + CAST(FI.fiscalYear AS VARCHAR) END AS PEO,
FI.periodEndDate,ERT.Errorresolutiondescription,CB.starttime,CB.endtime,E.errordatetime-- CEtoCS.collectionstageid
FROM CheckParameters_tbl CP (NOLOCK)
INNER JOIN CheckBatch_tbl CB (NOLOCK) ON CP.checkBatchId = CB.checkBatchId
--LEFT JOIN WorkflowArchive_Estimates.dbo.collectionentitytoprocess_tbl CEtoP (NOLOCK) ON cp.versionid = CEtoP.collectionentityid --and CEtoP.collectionProcessId = 64 --Estimates/Actuals/Guidance
--LEFT JOIN WorkflowArchive_Estimates.dbo.collectionentitytocollectionstage_tbl CEtoCS (NOLOCK) ON CEtoP.collectionentitytoprocessid = CEtoCS.collectionentitytoprocessid and CEtoCS.collectionStageId = 24 --2-Production --  24- master correction                    
LEFT JOIN Error_tbl E (NOLOCK) ON E.checkBatchId = CB.checkBatchId --   and E.raisedInCollectionEntityToCollectionStageId = CEtoCS.collectionEntityToCollectionStageId --Restricting to poduction CECS
LEFT JOIN Check_tbl C (NOLOCK) ON E.checkId = C.checkId
LEFT JOIN ErrorToEstimateDataValue_tbl EEDV (NOLOCK) ON EEDV.errorId = E.errorId
LEFT JOIN Estimatedetail_Tbl ED (NOLOCK) ON CP.feedFileId = ED.feedFileId AND CP.companyId=ED.companyId --EEDV.estimatedetailID = ED.estimatedetailID AND 
LEFT JOIN estimatePeriod_tbl FI (NOLOCK) ON FI.estimatePeriodId = ED.estimatePeriodId
LEFT JOIN ErrorToResolution_tbl ER (NOLOCK) ON ER.errorId = E.errorId 
LEFT JOIN ErrorResolutionType_tbl ERT (NOLOCK) ON ER.errorResolutionTypeId = ERT.errorResolutionTypeId
LEFT JOIN dataitemmaster_vw DM (NOLOCK) ON DM.dataitemID = EEDV.dataitemID
WHERE
CP.feedfileid IN (5536201,5566629,5562734,5560145,5566839,5565451,5548320,5566050,5566082,5561003,5565871,5536201,5566629,5562734,5560145,5566839,5565451,5548320,5566050,5566082,5561003,5565871,5562462,5576882,5571402,5573006,5579217,5578353,5571504,5571846,5570568,5572113,5547440,5573368,5571506,5575174,5573368,5577931,5570001,5573715,5578004,5569328,5572813,5592146,5595235,5583654,5592006,5592954,5583617,5594737,5582743,5585596,5583251,5581470,5589140,5597194,5601281,5604152,5598933,5597199,5598239,5599950,5604028,5601584,5596217,5599826,5601518,5547887,5559468,5557192,5559086,5547764,5546791,5558746,5559739,5558604,5546489,5559221,5550578,5547922,5556665,5556343,5555527)
AND CP.CompanyId IN (279513,551009282,34125194,25708,214631524,237245858,25708,329363059,265386,268799,48710124,279513,551009282,34125194,25708,214631524,237245858,25708,329363059,265386,268799,48710124,34378,264416006,224325923,108544096,8167776,384522,20357905,105310232,285359,878807,386024,384479410,5750742,879534,142659894,1353107,579312452,5556389,874687,26893,184841,167945,262198,874859,13529856,557929974,1814625476,534062888,343596,1470889,875776,883460,878671,1685468949,260426678,4509158,626020835,12763408,128034042,882603,325192855,3051118,1671690919,6521087,270999467,586061012,875419,22676462,630065948,4773318,5533649,5561540,22757600,264420908,1600081,42153793,291711182,9220926,13756315,37897459,9283092)
AND CP.versionId IS NULL
AND EEDV.dataitemID IS NOT NULL